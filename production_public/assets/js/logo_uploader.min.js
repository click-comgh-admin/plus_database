let cropper;function handleImageUpload(event){const file=event.target.files[0];if(file){const reader=new FileReader;reader.onload=function(e){const image=new Image;image.src=e.target.result,image.onload=function(){const preview=document.createElement("img");preview.id="previewImage",preview.src=image.src,preview.style.maxWidth="100%",preview.style.maxHeight="400px";const container=document.getElementById("profile-picture");container.innerHTML="",container.appendChild(preview),cropper=new Cropper(preview,{initialAspectRatio:1,aspectRatio:1,viewMode:2,minCanvasHeight:100,minCropBoxWidth:100})}},reader.readAsDataURL(file)}}function dataImageToBlob(imageData){const byteString=atob(imageData.split(",")[1]),mineString=imageData.split(",")[0].split(":")[1].split(";")[0],ab=new ArrayBuffer(byteString.length),ia=new Uint8Array(ab);for(let i=0;i<byteString.length;i++)ia[i]=byteString.charCodeAt(i);const blob=new Blob([ab],{type:mineString});return blob}function cropAndUpload(form){if(cropper&&form){console.log({cropper:cropper,form:form});const croppedCanvas=cropper.getCroppedCanvas(),croppedImage=croppedCanvas.toDataURL("image/jpeg"),blobedImage=dataImageToBlob(croppedImage),logoFile=new File([blobedImage],"image.jpg");var formdata=new FormData;formdata.append("logo",logoFile);const uploadUrl=form.action,uploadToken=atob(form.getAttribute("permissionKey"));fetch(uploadUrl,{method:"PATCH",body:formdata,headers:{Authorization:"Token "+uploadToken},redirect:"follow"}).then(response=>{response.ok?(Swal.fire("Success","Image uploaded successfully","success"),setTimeout(()=>{window.location.reload()},500)):Swal.fire("Error","Failed to upload image","error")}).catch(error=>{Swal.fire("Error","Failed to upload image","error")})}}const profile_img=document.getElementById("profile_img");profile_img.addEventListener("change",handleImageUpload);const forms=document.querySelectorAll("[crop-upload-posts]");console.log({forms:forms});for(let i=0;i<forms.length;i++){const form=forms[i];form&&form.addEventListener("submit",e=>{e.preventDefault(),cropAndUpload(form)})}